<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.101.0"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>Experiments With Chaos Physics - Using Blueprints - Unreal Engine Development Notes</title><meta name=author content="John Farrow"><meta name=description content="A minimal Hugo theme with nice theme color."><meta name=keywords content="unreal engine,chaos,physics,blueprints,blender"><meta property="og:title" content="Experiments With Chaos Physics - Using Blueprints"><meta name=twitter:title content="Experiments With Chaos Physics - Using Blueprints"><meta property="og:type" content="article"><meta property="og:url" content="https://johnjfarrow.github.io/posts/physicsblueprint/"><meta property="og:description" content="Notes on using Chaos Physics and Blueprints in Unreal Engine"><meta name=twitter:description content="Notes on using Chaos Physics and Blueprints in Unreal Engine"><meta property="og:image" content="https://johnjfarrow.github.io/img/og.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://johnjfarrow.github.io/img/og.png"><meta property="article:published_time" content="2022-07-12T10:27:06+12:00"><meta property="article:modified_time" content="2022-07-12T10:27:06+12:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://johnjfarrow.github.io/assets/css/fuji.min.css></head><body data-theme=auto data-theme-auto=true><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://johnjfarrow.github.io>Unreal Engine Development Notes</a>
<span class=title-sub>John Farrow</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://johnjfarrow.github.io/posts/physicsblueprint/>Experiments With Chaos Physics - Using Blueprints</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2022-07-12</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/unreal-engine>unreal engine</a>&nbsp;<a href=/tags/chaos>chaos</a>&nbsp;<a href=/tags/physics>physics</a>&nbsp;<a href=/tags/blueprints>blueprints</a>&nbsp;<a href=/tags/blender>blender</a>&nbsp;</span></div><div class="post-content markdown-body"><h2 id=introduction>Introduction</h2><p>This describes some initial steps in using chaos physics in Unreal Engine 5.0.2.</p><p>The image
below shows a working recreation of a medieval trebuchet built at <a href=https://en.wikipedia.org/wiki/Warwick_Castle target=_blank>Warwick Castle</a>
in England.</p><p><img class=img-zoomable src=/images/chaos_001.jpg alt></p><p>Image is from <a href=https://www.youtube.com/channel/UC89LF5ncbTZi9MukrMSN8eQ target=_blank>https://www.youtube.com/channel/UC89LF5ncbTZi9MukrMSN8eQ</a></p><p>This article describes the steps I took to create a working trebuchet model in Unreal Engine.</p><h2 id=blender-model>Blender Model</h2><p>The image below show an unshaded blender model of the trebuchet.</p><p><img class=img-zoomable src=/images/chaos_002.png alt></p><p>This model is constructed of these parts:</p><ol><li>the base</li><li>the arm</li><li>the counterweight</li><li>the ramp</li></ol><p>Each of these was exported from Blender in FBX format using these options</p><p><img class=img-zoomable src=/images/chaos_003.png alt></p><h3 id=exporting-at-the-origin>Exporting at the Origin</h3><p>Before exporting it, each component was moved to the origin in Blender. This makes it easier to
work with the meshes once they are imported into Unreal. It makes the local coordinate
system meaningful.</p><p>Taking the arm component as an example,
if it is centered on the world origin in Blender and then exported, in Unreal it looks
like this:</p><p><img class=img-zoomable src=/images/chaos_004.png alt></p><p>If it is not centered on the world origin in Blender, in Unreal it looks
like this:</p><p><img class=img-zoomable src=/images/chaos_005.png alt></p><p>The difference in the position of the arm&rsquo;s origin effects how it easy it is to manipulate
once the FBX file has been imported as a mesh and referenced by a Static Mesh component in blueprint. As this image shows, when the
arm is positioned at the world origin in Blender, the
Unreal transform gizmo (using world coordinates) is centered on the arm origin:</p><p><img class=img-zoomable src=/images/chaos_006.png alt></p><p>and when using local coordinates the Unreal transform gizmo is centered on the arm origin
and aligned parallel with the arm to make it easy to position and rotate the arm.</p><p><img class=img-zoomable src=/images/chaos_008.png alt></p><p>If the arm is not centered on the world origin in Blender before it is exported, this is what
it looks like in Unreal:</p><p><img class=img-zoomable src=/images/chaos_007.png alt></p><p>The Unreal transform gizmo is not positioned on the arm, making it harder to position, and
the local and world coordinate systems are the same, making it difficult to rotate without
manually changing the pivot point.</p><h2 id=using-chaos-physics>Using Chaos Physics</h2><p>To get to the position where we can start adding Physics Constraints, perform these steps to import the FBX files exported from Blender and create a blueprint trebuchet object:</p><ul><li>launch Unreal Editor</li><li>create a new project with the Games, Blank, Blueprint options</li><li>make new folders under the &ldquo;Content&rdquo; folder called &ldquo;Blueprints&rdquo; and &ldquo;Meshes&rdquo;</li><li>open the Meshes folder and drop in <a href=https://github.com/JohnJFarrow/johnjfarrow.github.io/blob/39d7370ff16e943d3db762b22bfa653119949e00/fbx/trebuchet/Arm.fbx target=_blank>Arm.fbx</a>, <a href=https://github.com/JohnJFarrow/johnjfarrow.github.io/blob/39d7370ff16e943d3db762b22bfa653119949e00/fbx/trebuchet/Weight.fbx target=_blank>Weight.fbx</a>, <a href=https://github.com/JohnJFarrow/johnjfarrow.github.io/blob/39d7370ff16e943d3db762b22bfa653119949e00/fbx/trebuchet/Ramp.fbx target=_blank>Ramp.fbx</a>
and <a href=https://github.com/JohnJFarrow/johnjfarrow.github.io/blob/39d7370ff16e943d3db762b22bfa653119949e00/fbx/trebuchet/Base.fbx target=_blank>Base.fbx</a></li><li>rename these meshes SM_Arm, SM_Weight, SM_Ramp, and SM_Base respectively</li><li>in the Blueprints directory create a new blueprint derived from the Actor parent class. Rename this BP_Trebuchet</li><li>open BP_Trebuchet in the blueprint editor</li><li>add a Static Mesh component<ul><li>rename this &ldquo;Base&rdquo;</li><li>set its static mesh property to &ldquo;SM_Base&rdquo;</li><li>set its mobility property to &ldquo;Static&rdquo;; this will change Collision Presets to BlockAll</li></ul></li><li>drag the Base component and drop it on the &ldquo;DefaultSceneRoot&rdquo; to make it the root component</li><li>add another Static Mesh component<ul><li>rename this &ldquo;Arm&rdquo;</li><li>set its static mesh property to &ldquo;SM_Arm&rdquo;</li><li>set Simulate Physics to checked, this will change Collision Presets to PhysicsActor</li><li>set its mass to 505 kg which is calculated from its volume and the density of ash</li><li>set Enable Gravity to checked</li><li>position the arm to intersect the base axle like so:</li></ul></li></ul><p><img class=img-zoomable src=/images/chaos_009.png alt></p><h4 id=things-fly-apart>Things fly apart</h4><p>If you press the Simulate button now you will see something like this:</p><p><img class=img-zoomable src=/images/chaos_010.gif alt></p><p>What&rsquo;s happening here is that the base and the arm are colliding; in their start positions they are occupying the same
space where the arm intersects the base axle. The chaos physics solver tries to push them apart violently.</p><p>This can be prevented by adding a Physics Constraint component to BP_Trebuchet.</p><h3 id=preventing-armbase-collision>Preventing Arm/Base Collision</h3><p>The Physics Constraint is the standard building block of chaos physics. It can apply linear and angular forces
to objects, and constrains the interactions between objects. For now we just want to stop the base and arm objects
colliding, so we:</p><ul><li>add a Physics Constraint component</li><li>rename it &ldquo;ArmBaseStopCollision&rdquo;</li><li>set Component Name 1 to &ldquo;Base&rdquo;</li><li>set Component Name 2 to &ldquo;Arm&rdquo;</li><li>under &ldquo;Constraint Behaviour&rdquo; set Disable Collision to checked</li><li>set all the linear and angular limits to Free so this constraint does not affect the motion of the arm, like this:</li></ul><p><img class=img-zoomable src=/images/chaos_012.png alt></p><p>Now if you press the Simulate button now you will see something like this:</p><p><img class=img-zoomable src=/images/chaos_011.gif alt></p><p>This is what we expect, the arm falls because gravity acts on it, and we have disabled collision with the base so the
arm falls right through the base. (If you are using Unreal 5.0.2 you might need to close the blueprint editor window and reopen it to reset the simulation)</p><h3 id=constraining-the-arm>Constraining the Arm</h3><p>We want the arm to pivot around the axle. If we change all the Linear Limits to Locked, and
change Swing 1 Motion and Swing 2 Motion to locked, leaving Twist Motion as Free, the only
way the arm can move is to pivot is around the X axis.</p><p><img class=img-zoomable src=/images/chaos_013.png alt></p><p>Looking at the tooltip for Twist Limit it sort of explains what Twist Motion does: &ldquo;Symmetric angle of roll along the X-axis&rdquo;. This
tells us the Twist Motion properties control the twist around <strong>the X-axis of the constraint, not the X-Axis of the
constrained components</strong>. You can see this by changing the yaw angle (rotation around the local X-axis) of the constraint - at 45 degrees
the arm just tips over slightly, at 90 degrees nothing happens at all.</p><p>Looking at the image below, we can see the constraint X-axis (the red one) is pointing parallel to the axle
which is what we want.</p><p><img class=img-zoomable src=/images/chaos_014.png alt></p><p>If we press the Simulate button from this position the arm pivots around the position of the constraint like so:</p><p><img class=img-zoomable src=/images/chaos_014.gif alt></p><p>If we position the constraint where the axle is like this:</p><p><img class=img-zoomable src=/images/chaos_015.png alt></p><p>Then we get the arm swinging in the way we want:</p><p><img class=img-zoomable src=/images/chaos_016.gif alt></p><h3 id=adding-the-counterweight>Adding the Counterweight</h3><p>Add another Static Mesh component</p><ul><li>rename this &ldquo;Weight&rdquo;</li><li>set its static mesh property to &ldquo;SM_Weight&rdquo;</li><li>set Simulate Physics to checked, this will change Collision Presets to PhysicsActor</li><li>set its mass to 4506 kg which is calculated from its volume and the density of stone</li><li>set Enable Gravity to checked</li><li>position the weight to intersect the arm like so:</li></ul><p><img class=img-zoomable src=/images/chaos_017.png alt></p><p>Add a Physics Constraint component to link the weight to the arm:</p><ul><li>rename it &ldquo;ArmWeightConstraint&rdquo;</li><li>set Component Name 1 to &ldquo;Arm&rdquo;</li><li>set Component Name 2 to &ldquo;Weight&rdquo;</li><li>under &ldquo;Constraint Behaviour&rdquo; set Disable Collision to checked</li><li>move the constraint to where the weight is attached to the arm</li></ul><p>Add another Physics Constraint just to stop the weight colliding with the base:</p><ul><li>rename it &ldquo;BaseWeightConstraint&rdquo;</li><li>set Component Name 1 to &ldquo;Base&rdquo;</li><li>set Component Name 2 to &ldquo;Weight&rdquo;</li><li>under &ldquo;Constraint Behaviour&rdquo; set Disable Collision to checked</li><li>set all the limits to Free so it does nothing but disable the collision:</li></ul><p><img class=img-zoomable src=/images/chaos_012.png alt></p><h3 id=collision-meshes>Collision Meshes</h3><p>Even though we can see that the base and the weight do not collide the BaseWeightConstraint constraint
is necessary because the base is using a simple collision volume. Open the SM_Base mesh
and click Show | Simple Collision, this shows that the base is using a collision volume which
includes the area where the weight swings:</p><p><img class=img-zoomable src=/images/chaos_019.png alt></p><p>An alternative to adding the BaseWeightConstraint constraint is to use the complex collision
volume for the base. Click Show | Complex Collision to show the more complex and better
fitting collision volume:</p><p><img class=img-zoomable src=/images/chaos_020.png alt></p><p>We can use this by changing the Collision Complexity property of the SM_Mesh to &ldquo;Use Complex Collision as Simple&rdquo;
which will make Unreal use the complex collision volume in all cases.</p><p>Now when simulating the weight should pull the arm down like so:</p><p><img class=img-zoomable src=/images/chaos_018.gif alt></p><h3 id=adding-the-ramp>Adding the Ramp</h3><p>The ramp is a separate mesh which the projectile slides along when it is launched. It is added
by:</p><ul><li>adding a new Static Mesh to BP_Trebuchet component</li><li>rename this &ldquo;Ramp&rdquo;</li><li>set its static mesh property to &ldquo;SM_Ramp&rdquo;</li><li>set its mobility property to &ldquo;Static&rdquo;; this will change Collision Presets to BlockAll</li><li>position it like this:</li></ul><p><img class=img-zoomable src=/images/chaos_021.png alt></p><h3 id=adding-the-projectile>Adding the Projectile</h3><p>The projectile is Sphere component. In theory it could be a separate actor because there can be many
projectiles, and when they are thrown the move far away from the trebuchet, but for the purposes of learning chaos physics a component will suffice.</p><p>Add the projectile by</p><ul><li>adding a new Sphere component to BP_Trebuchet component</li><li>rename this &ldquo;Ball&rdquo;</li><li>set Simulate Physics to checked, this will change Collision Presets to PhysicsActor</li><li>set its mass to 15 kg</li><li>set Enable Gravity to checked</li><li>position it on the ramp like this:</li></ul><p><img class=img-zoomable src=/images/chaos_022.png alt></p><p>When the real trebuchet fires the arm is positioned close to the ground as shown in the
top picture, so rotate the arm to a similar position like this:</p><p><img class=img-zoomable src=/images/chaos_023.png alt></p><p>We will use a Physics Constraint to represent the connection between the arm and the ball. So:</p><ul><li>add a Physics Constraint component</li><li>rename it &ldquo;CableConstraint&rdquo;</li><li>set Component Name 1 to &ldquo;Arm&rdquo;</li><li>set Component Name 2 to &ldquo;Ball&rdquo;</li><li>under &ldquo;Constraint Behaviour&rdquo; set Disable Collision to checked</li><li>set all the linear limits to Locked and all the angular limits to Free</li><li>position the constraint at the end of the arm like this:</li></ul><p><img class=img-zoomable src=/images/chaos_024.png alt></p><p>Now pressing Play in the editor should result in this motion:</p><p><img class=img-zoomable src=/images/chaos_025.gif alt></p><h3 id=releasing-the-projectile>Releasing the Projectile</h3><p>The ball swings in the manner we want, but it remains connected to the arm. We need to find a way to break
the constraint connecting the ball to the arm. There are several ways to do this, we could for example:</p><ul><li>break the constraint when the ball enters a certain area</li><li>break the constraint when the ball is travelling at a certain angle</li><li>break the constraint when the ball is travelling at a certain velocity</li></ul><p>We can visualize the velocity using a blueprint like this:</p><p><img class=img-zoomable src=/images/chaos_026.png alt></p><p>Assuming the trebuchet is aligned to fire down the X-axis, when the velocity in the X direction is greater than zero this blueprint will:</p><ul><li>draw a vector representing the velocity of the ball, so a longer line represents a greater velocity</li><li>print the angle of the velocity at the end of each vector</li></ul><p>The output looks like this:</p><p><img class=img-zoomable src=/images/chaos_027.gif alt></p><p>This is the last frame:</p><p><img class=img-zoomable src=/images/chaos_028.png alt></p><p>If we arbitrarily decide to fire when the angle is about 45 degrees, we can calculate the angle of the projectile from the velocity, and break the constraint between the arm and the ball as soon as the angle is &lt;= 45 degrees.</p><p>We update the blueprint by adding a variable to track if the constraint has been broken,
and break the constraint the first time the angle is &lt;= 45 degrees:</p><p><img class=img-zoomable src=/images/chaos_029.png alt></p><p>And we get this result:</p><p><img class=img-zoomable src=/images/chaos_030.gif alt></p></div></article><div class="license markdown-body"><blockquote><p>Unless otherwise noted, the content of this site is licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a>.</p></blockquote></div></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=/>Home</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/johnjfarrow target=_blank><span>GitHub</span></a></li><li><a href=https://www.linkedin.com/in/johnjfarrow target=_blank><span>LinkedIn</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/tags/blender/>blender</a></span>
<span><a href=/tags/blueprints/>blueprints</a></span>
<span><a href=/tags/build/>build</a></span>
<span><a href=/tags/c++/>c++</a></span>
<span><a href=/tags/chaos/>chaos</a></span>
<span><a href=/tags/ffmpeg/>ffmpeg</a></span>
<span><a href=/tags/gif/>gif</a></span>
<span><a href=/tags/json/>json</a></span>
<span><a href=/tags/physics/>physics</a></span>
<span><a href=/tags/reflection/>reflection</a></span>
<span><a href=/tags/slate/>slate</a></span>
<span><a href=/tags/unreal-engine/>unreal engine</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#blender-model>Blender Model</a><ul><li><a href=#exporting-at-the-origin>Exporting at the Origin</a></li></ul></li><li><a href=#using-chaos-physics>Using Chaos Physics</a><ul><li></li><li><a href=#preventing-armbase-collision>Preventing Arm/Base Collision</a></li><li><a href=#constraining-the-arm>Constraining the Arm</a></li><li><a href=#adding-the-counterweight>Adding the Counterweight</a></li><li><a href=#collision-meshes>Collision Meshes</a></li><li><a href=#adding-the-ramp>Adding the Ramp</a></li><li><a href=#adding-the-projectile>Adding the Projectile</a></li><li><a href=#releasing-the-projectile>Releasing the Projectile</a></li></ul></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=/>Home</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/johnjfarrow target=_blank><span>GitHub</span></a></li><li><a href=https://www.linkedin.com/in/johnjfarrow target=_blank><span>LinkedIn</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/tags/blender/>blender</a></span>
<span><a href=/tags/blueprints/>blueprints</a></span>
<span><a href=/tags/build/>build</a></span>
<span><a href=/tags/c++/>c++</a></span>
<span><a href=/tags/chaos/>chaos</a></span>
<span><a href=/tags/ffmpeg/>ffmpeg</a></span>
<span><a href=/tags/gif/>gif</a></span>
<span><a href=/tags/json/>json</a></span>
<span><a href=/tags/physics/>physics</a></span>
<span><a href=/tags/reflection/>reflection</a></span>
<span><a href=/tags/slate/>slate</a></span>
<span><a href=/tags/unreal-engine/>unreal engine</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#blender-model>Blender Model</a><ul><li><a href=#exporting-at-the-origin>Exporting at the Origin</a></li></ul></li><li><a href=#using-chaos-physics>Using Chaos Physics</a><ul><li></li><li><a href=#preventing-armbase-collision>Preventing Arm/Base Collision</a></li><li><a href=#constraining-the-arm>Constraining the Arm</a></li><li><a href=#adding-the-counterweight>Adding the Counterweight</a></li><li><a href=#collision-meshes>Collision Meshes</a></li><li><a href=#adding-the-ramp>Adding the Ramp</a></li><li><a href=#adding-the-projectile>Adding the Projectile</a></li><li><a href=#releasing-the-projectile>Releasing the Projectile</a></li></ul></li></ul></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2020-2022
<a href=https://johnjfarrow.github.io>John Farrow</a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=/assets/js/fuji.min.js></script></body></html>