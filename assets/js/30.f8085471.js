(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{313:function(e,t,a){"use strict";a.r(t);var s=a(14),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",[e._v(e._s(this.$page.title))]),e._v(" "),a("p",[e._v("Updated for Unreal Engine 5.1.1")]),e._v(" "),a("h2",{attrs:{id:"using-c-20"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-c-20"}},[e._v("#")]),e._v(" Using C++20")]),e._v(" "),a("p",[e._v("These code here is developed and tested using Visual Studio 2022 setup as described "),a("RouterLink",{attrs:{to:"/content/BuildFromSource.html"}},[e._v("here")])],1),e._v(" "),a("h2",{attrs:{id:"project-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#project-configuration"}},[e._v("#")]),e._v(" Project Configuration")]),e._v(" "),a("p",[e._v("As at April 2023 Unreal Engine is configured to use c++17 by default.")]),e._v(" "),a("p",[e._v("To configure a project to use c++20 add this line to the Project.build.cs")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("CppStandard = CppStandardVersion.Cpp20;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"subobjects"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#subobjects"}},[e._v("#")]),e._v(" Subobjects")]),e._v(" "),a("p",[e._v("The USubobjectDataSubsystem class has methods for finding the\ncomponents which make up a blueprint. We will use this as a example.  The stages of getting from a blueprint\nto a specific component (whether by type or name) are:")]),e._v(" "),a("ul",[a("li",[e._v("the USubobjectDataSubsystem gives us a list of FSubobjectDataHandle data handles")]),e._v(" "),a("li",[e._v("from the FSubobjectDataHandle data handles we can get a list of FSubobjectData data items")]),e._v(" "),a("li",[e._v("from the FSubobjectData data items we can get a list of UObject pointers (each of which is a component)")]),e._v(" "),a("li",[e._v("then we can filter the UObject pointers to get the type we want")])]),e._v(" "),a("p",[e._v("The process of getting from the list of FSubobjectDataHandle data handles to\na smaller list of components looks like this in python, using nested list comprehensions:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('components = \n    [ comp for comp in \n\t\t[ library.get_object(subobject) for subobject in \n\t\t\t[ subsystem.k2_find_subobject_data_from_handle(handle) for handle in \n\t\t\t\t\tsubsystem.k2_gather_subobject_data_for_blueprint(context=blueprint) ] \n\t\t\t]\n\t\tif comp.get_class().get_name() == "MyActorComponent"\n\t]\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("h2",{attrs:{id:"ranges"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ranges"}},[e._v("#")]),e._v(" Ranges")]),e._v(" "),a("p",[e._v("To do the same thing in c++ as the python code above does we will use the\nstd::ranges classes, new in c++20.")]),e._v(" "),a("p",[e._v("Having included the "),a("code",[e._v("<ranges>")]),e._v(" header file we can write this like so:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('UBlueprint* CarBlueprint = Cast<UBlueprint>( UEditorAssetLibrary::LoadAsset\n            ("/Game/VehicleTemplate/Blueprints/SportsCar/SportsCar_Pawn"));\n\nTArray< FSubobjectDataHandle > SubobjectDataHandles;\n\n// get the subobject data handles into an unreal TArray\nSubobjectDataSubsystem->K2_GatherSubobjectDataForBlueprint(CarBlueprint, SubobjectDataHandles);\n\n// copy from the TArray to a std::vector\nstd::vector< FSubobjectDataHandle > Handles(SubobjectDataHandles.Num());\nfor (int j = 0; j < SubobjectDataHandles.Num(); ++j)\n{\n    Handles[j] = SubobjectDataHandles[j];\n}\n\n// create a range of USkeletalMeshComponent* from the vector of handles\n\nauto range = Handles\n    | std::views::transform([&SubobjectDataSubsystem](const FSubobjectDataHandle& Handle) {\n        // handles to FSubobjectData\n        FSubobjectData Data;\n        SubobjectDataSubsystem->K2_FindSubobjectDataFromHandle(Handle, Data);\n        return Data;\n    })\n    | std::views::transform([](const FSubobjectData& Data) {\n        // FSubobjectData to UObject*\n        return USubobjectDataBlueprintFunctionLibrary::GetObject(Data);\n    })\n    | std::views::filter([](const UObject* Object) {\n        // just return the skeletal mesh components\n        return ( Cast< const USkeletalMeshComponent >(Object) != nullptr );\n    })\n    | std::views::transform([](const UObject* Object) {\n        // UObject* to USkeletalMeshComponent*&\n        return Cast< const USkeletalMeshComponent >(Object);\n    });\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br")])]),a("p",[e._v("Each stage of the process is either a call to "),a("code",[e._v("std::views::transform")]),e._v(" which transforms an item\nin the list from one type to another, or a call to "),a("code",[e._v("std::views::filter")]),e._v(" which removes\nitems from the list if they do not match the selection criteria.")]),e._v(" "),a("p",[e._v("The result of the code above is  the objects "),a("code",[e._v("range")]),e._v(" on which we can\nuse in a loop to iterate over all the USkeletalMeshComponent like so:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("for (const USkeletalMeshComponent* SkelMesh : range)\n{\n    CompareSkeletalMeshComponents( SkelMesh, OtherSkelMesh );\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://devblogs.microsoft.com/cppblog/documentation-for-cpp20-ranges/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Microsoft Ranges"),a("OutboundLink")],1),a("br"),e._v(" "),a("a",{attrs:{href:"https://timur.audio/how-to-make-a-container-from-a-c20-range",target:"_blank",rel:"noopener noreferrer"}},[e._v("Making a Container from a C++20 Range"),a("OutboundLink")],1),a("br"),e._v(" "),a("a",{attrs:{href:"https://www.cppstories.com/2021/filter-cpp-containers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Filtering Containers"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);