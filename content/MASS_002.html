<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mass 002 Mass Overview | unrealcode.net</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Overview of Mass">
    
    <link rel="preload" href="/assets/css/0.styles.06a2c7d8.css" as="style"><link rel="preload" href="/assets/js/app.1a1bcabe.js" as="script"><link rel="preload" href="/assets/js/3.5e27fb36.js" as="script"><link rel="preload" href="/assets/js/2.32bfe7ad.js" as="script"><link rel="preload" href="/assets/js/26.ae6327cd.js" as="script"><link rel="prefetch" href="/assets/js/10.49e97280.js"><link rel="prefetch" href="/assets/js/11.6e4ef963.js"><link rel="prefetch" href="/assets/js/12.0d1be04c.js"><link rel="prefetch" href="/assets/js/13.f0527924.js"><link rel="prefetch" href="/assets/js/14.511875d3.js"><link rel="prefetch" href="/assets/js/15.8fbca2bd.js"><link rel="prefetch" href="/assets/js/16.ccc64059.js"><link rel="prefetch" href="/assets/js/17.555bef63.js"><link rel="prefetch" href="/assets/js/18.954adcd7.js"><link rel="prefetch" href="/assets/js/19.c4ba1c17.js"><link rel="prefetch" href="/assets/js/20.86f91cee.js"><link rel="prefetch" href="/assets/js/21.d649793e.js"><link rel="prefetch" href="/assets/js/22.78da9d4f.js"><link rel="prefetch" href="/assets/js/23.69d54750.js"><link rel="prefetch" href="/assets/js/24.f5bbc596.js"><link rel="prefetch" href="/assets/js/25.7973a587.js"><link rel="prefetch" href="/assets/js/27.e0d36fa0.js"><link rel="prefetch" href="/assets/js/28.c1e7ad63.js"><link rel="prefetch" href="/assets/js/29.4f4d6c3f.js"><link rel="prefetch" href="/assets/js/30.2578dbe5.js"><link rel="prefetch" href="/assets/js/31.cf2d3386.js"><link rel="prefetch" href="/assets/js/32.81861962.js"><link rel="prefetch" href="/assets/js/33.7fa418e0.js"><link rel="prefetch" href="/assets/js/34.b9c56611.js"><link rel="prefetch" href="/assets/js/35.290c21b9.js"><link rel="prefetch" href="/assets/js/36.3e48a375.js"><link rel="prefetch" href="/assets/js/37.4e5efe63.js"><link rel="prefetch" href="/assets/js/38.13b5b283.js"><link rel="prefetch" href="/assets/js/39.6d3c0f3d.js"><link rel="prefetch" href="/assets/js/4.b728e6f4.js"><link rel="prefetch" href="/assets/js/40.22519dd8.js"><link rel="prefetch" href="/assets/js/41.09218c23.js"><link rel="prefetch" href="/assets/js/5.fbe4e9e0.js"><link rel="prefetch" href="/assets/js/6.5aa171c8.js"><link rel="prefetch" href="/assets/js/7.592d144b.js"><link rel="prefetch" href="/assets/js/8.675e70c4.js"><link rel="prefetch" href="/assets/js/9.876839a1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.06a2c7d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">unrealcode.net</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mass 002 Mass Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/content/MASS_002.html#about-mass" class="sidebar-link">About Mass</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/MASS_002.html#an-example-project" class="sidebar-link">An Example Project</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/MASS_002.html#c-classes-for-entity-fragment" class="sidebar-link">C++ Classes for Entity, Fragment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/content/MASS_002.html#fragments" class="sidebar-link">Fragments</a></li><li class="sidebar-sub-header"><a href="/content/MASS_002.html#tags" class="sidebar-link">Tags</a></li><li class="sidebar-sub-header"><a href="/content/MASS_002.html#archetypes" class="sidebar-link">Archetypes</a></li></ul></li><li><a href="/content/MASS_002.html#entity-setup" class="sidebar-link">Entity Setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/MASS_002.html#todo" class="sidebar-link">TODO</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/MASS_002.html#references" class="sidebar-link">References</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1>Mass 002 Mass Overview</h1> <h2 id="about-mass"><a href="#about-mass" class="header-anchor">#</a> About Mass</h2> <p>Mass is a framework for supporting large amounts of entities in a game by using data oriented
approaches.  Mass is implemented in Unreal 5.2 as a collection of plugins.</p> <p>This post is based on <a href="https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass" target="_blank" rel="noopener noreferrer">this tutorial<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> combined with additional information.</p> <h2 id="an-example-project"><a href="#an-example-project" class="header-anchor">#</a> An Example Project</h2> <p>Launch Unreal 5.2 or higher, create a new project with Games, Third Person, C++, Desktop, Maximum</p> <p>Enable these plugins:</p> <ul><li>MassAI</li> <li>MassCrowd</li> <li>MassEntity</li> <li>MassGameplay</li> <li>StateTree</li> <li>ZoneGraph</li> <li>ZoneGraph Annotations</li></ul> <p>Restart the editor if requested.</p> <h2 id="c-classes-for-entity-fragment"><a href="#c-classes-for-entity-fragment" class="header-anchor">#</a> C++ Classes for Entity, Fragment</h2> <h3 id="fragments"><a href="#fragments" class="header-anchor">#</a> Fragments</h3> <p>The Fragment is the structure which holds data for entities in Mass.  Every fragment must derive<br>
from the <code>FMassFragment</code> struct.  The <code>FMassFragment</code> struct is declared like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>USTRUCT()
struct FMassFragment
{
	GENERATED_BODY()
	FMassFragment() {}
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>It has no data or members so adds no size to the data stored in the derived
fragment.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>USTRUCT()
struct MASSCOMMON_API FAgentRadiusFragment : public FMassFragment
{
	GENERATED_BODY()
	UPROPERTY(EditAnywhere, Category = &quot;&quot;)
	float Radius = 40.f;
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Deriving from FMassFragment adds no data to the object, the sizeof(float) is 4 and sizeof(FAgentRadiusFragment) is also 4.</p> <h3 id="tags"><a href="#tags" class="header-anchor">#</a> Tags</h3> <p>A tag is structure like a Fragment but it does not hold any data.  It is
used to filter entities in queries, so you can select entities which do
or do not have the specified tag.</p> <p>For example this tag is used to differentiate the crowd entity
from other entities in the MassCrowd module, so the crowd entity will
have this tag and no other entity will have it.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>USTRUCT()
struct MASSCROWD_API FMassCrowdTag : public FMassTag
{
	GENERATED_BODY()
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="archetypes"><a href="#archetypes" class="header-anchor">#</a> Archetypes</h3> <p>An archtype is a unique combination of fragment and tag types.</p> <p>The struct <strong>FMassArchetypeData</strong> stores details of the fragment types
and tag types which make up the archetype.  It also stores
the actual fragment data in an array of <strong>FMassArchetypeChunk</strong> chunks.
A chunk is a small object which holds the fragments (that is the data) for
a fixed small number of entities.</p> <p>For example if the entity consists of two fragments, a VelocityFragment
and a PositionFragment, and there are 32 entities, then each chunk
might hold the data for (say) 4 entities, so there would be 8 chunks
and each chunk found logically look like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct Chunk
{
    VelocityFragment Velocities[4];
    PositionFragment Positions[4];
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The intent here is that a Processor (i.e. a function which updates entities) will
execute a query to fetch an archetype which contains only the data which it
needs and then operate on that data and the data will be in a cache-friendly layout because:</p> <ul><li>only needed data is returned in the archetype so no cycles are wasted copying
unnecessary data</li> <li>the chunk size is derived from the cache line size so as far as is possible
all the data needed by the function is in the cache at once</li></ul> <p>Anyone seen this strange behavior with the LOD system? If my number of entities exceeds the LODMax &quot;Low&quot; count, they all get culled with tag MassVisibilityCulledByFrustumTag (or is that by design? I thought it would keep that count visible and cull the rest)
Boltz — Today at 13:25
Turns out this was because the MassLODCollectorPRocessor is disabled by default (only the Crowd version is enabled), which means that the view distance was not being calculated</p> <p>Explain each of these with their associated c++ class</p> <p>Mass Key Terminology</p> <div class="language- extra-class"><pre><code>Entity - This is the base class of Mass that holds pointers to all of its Fragments
Fragment - Holds the data/state for an Entity in tightly packed arrays (e.g. transform, velocity, current LOD, etc.)
Archetype - Entities with identical Fragment composition that are grouped together. Entity composition can change at runtime resulting in Archetype migration
Trait - Group fragments together and typically represent Entity features (e.g. Movement, ZoneGraph Navigation, SmartObject User)
Tags - Archetype-level, Dataless Fragments that can be used by Queries for filtering archetypes based on their presence or absence
Chunk Fragment - Fragments that are applied to a subset of Entities in an Archetype instead of directly to a single Entity
Shared Fragment - Fragments with data that are shared with multiple entities for memory optimization purposes
Processor - Where logic execution occurs in Mass. Processors can change values of a Fragment as well as composition of Entities (adding or removing).
Entity Query - A query used by processors that filters archetypes based on fragment and/or tag requirements. The EntityQuery returns batches of fragments without regard to the individual Entity identifiers
Mass Spawner - System for adding Entities to a level at runtime
Mass Entity Config - Asset that defines the Mass agent to spawn by specifying traits of the Entity
</code></pre></div><h2 id="entity-setup"><a href="#entity-setup" class="header-anchor">#</a> Entity Setup</h2> <p><a href="https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass" target="_blank" rel="noopener noreferrer">following<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Add a new folder Content/MASS
Add a Miscellaneous &gt; Data Asset &gt; Class = MassEntityConfigAsset, Name = MassNPCEntityConfig
Make a new Level from File &gt; New Level &gt; Basic</p> <p>So at a high level we have</p> <p>Level
Mass Spawner object on map
Entity Types = MassEntityConfigAsset[]
-- list of types of entities which get spawned
-- MassEntityConfigAsset
-- has list of traits i.e movement, visualization, debug, replication - long list
-- its made up of traits which are collections of fragments?
-- has debug visualization trait - display cones or whatever
-- visualzation trait
-- can specify static meshes/actors for LODS
-- lod high, medium, low, off<br>
-- count of entities
-- proportional split between types
Spawn Data Generators =
-- list of generators = EnvironmentQuery[]
-- generator has a query template
-- i.e. generate items around querier, radius 1000-3000 5 rings etc
-- generates spawn points?</p> <p>Adding Visualization trait and pressing &quot;Validate Entity Config&quot; button logs this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>LogMass: Error: Trait(MassVisualizationTrait) has missing dependency:
LogMass: Error:         MassViewerInfoFragment
LogMass: Error:         TransformFragment
LogMass: Error:         MassActorFragment
LogMass: Error: Some traits are requiring the presence of fragments which are missing!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Fix by adding another trait of type &quot;Assorted Fragments&quot; then add the 3 fragments
to that trait.</p> <p>Debugging:
type EnableGDT into CMD console to display stuff</p> <h2 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h2> <p>shared fragments
shared tags</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/coreinfo" target="_blank" rel="noopener noreferrer">CoreInfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass" target="_blank" rel="noopener noreferrer">First 60 minutes with Mass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://docs.unrealengine.com/5.2/en-US/overview-of-mass-entity-in-unreal-engine/" target="_blank" rel="noopener noreferrer">Overview of Mass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main> <footer class="f"><div><p>MIT Licensed | Copyright © 2020-2023 John Farrow</p></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1a1bcabe.js" defer></script><script src="/assets/js/3.5e27fb36.js" defer></script><script src="/assets/js/2.32bfe7ad.js" defer></script><script src="/assets/js/26.ae6327cd.js" defer></script>
  </body>
</html>
