<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UObjects, Generated Classes, and Class Default Objects (CDOs) | unrealcode.net</title>
<meta name="description" content="UObjects, Generated Classes, and Class Default Objects (CDOs)">
<meta charset="utf-8">
<link rel="stylesheet" href="./css/styles.css">
<link rel="stylesheet" href="./css/syntaxhighlightingstyles.css">
</head>
<body>
<div id="app" data-server-rendered="true">
<div class="theme-container">
</div>
<header class="navbar">
<div class="sidebar-button">
</div>
<a href="index.html" aria-current="page" class="home-link router-link-exact-active router-link-active">
<span class="site-name">
unrealcode.net
</span>
</a>
<div class="links">
<nav class="nav-links can-hide">
<div class="nav-item">
<a href="index.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
Home
</a>
</div>
</nav>
</div>
</header>
<div class="sidebar-mask">
</div>
<aside class="sidebar">
<ul class="sidebar-links">
<li>
<section class="sidebar-group depth-0">
<p class="sidebar-heading open">
<span>
UObjects, Generated Classes, and Class Default Objects (CDOs)
</span>
</p>
<ul class="sidebar-links sidebar-group-items">
<li>
<a class="sidebar-link" href="#introduction">
Introduction
</a>
</li>
<li>
<a class="sidebar-link" href="#class-default-objects-(cdos)">
Class Default Objects (CDOs)
</a>
</li>
<li>
<a class="sidebar-link" href="#static-classes">
Static Classes
</a>
</li>
<li>
<a class="sidebar-link" href="#generated-classes">
Generated Classes
</a>
</li>
<li>
<a class="sidebar-link" href="#default-values-of-blueprint-components">
Default values of Blueprint Components
</a>
</li>
<li>
<a class="sidebar-link" href="#references">
References
</a>
</li>
</ul>
</section>
</li>
</ul>
</aside>
<main class="page">
<div class="theme-default-content content__default">
<h1>UObjects, Generated Classes, and Class Default Objects (CDOs)</h1>
<h2 id="introduction">Introduction</h2>
<p>This post documents how a UObject functions in Unreal Engine
and how the classes generated by the Unreal Header Tool (UHT) work.</p>
<p>If we create a new game project and add a c++ class which derives from ActorComponent
we get this:</p>
<div class="cplusplus"><pre>
UCLASS( ClassGroup=(Custom), meta=(BlueprintSpawnableComponent) )
<span class="keyword">class</span> UOBJECTS_API UMyActorComponent : <span class="keyword">public</span> UActorComponent
{
	GENERATED_BODY()

<span class="keyword">public</span>:	
	<span class="comment">// Sets default values for this component&#39;s properties</span>
	UMyActorComponent();

<span class="keyword">protected</span>:
	<span class="comment">// Called when the game starts</span>
	<span class="keyword">virtual</span> <span class="keyword">void</span> BeginPlay() override;

<span class="keyword">public</span>:	
	<span class="comment">// Called every frame</span>
	<span class="keyword">virtual</span> <span class="keyword">void</span> TickComponent(<span class="keyword">float</span> DeltaTime, ELevelTick TickType, 
		FActorComponentTickFunction* ThisTickFunction) override;
};
</pre></div>
<p>The UCLASS and GENERATED_BODY() macros are used by the Unreal header tool to generate additional code which 
supports reflection, serialization etc. and most importantly supports using the class
in the Unreal Editor.  It also support using the class from python, which we will
do below in the interest of making the examples shorter.</p>
<p>We add a member variable and use the UPROPERTY macro like so:</p>
<div class="cplusplus"><pre>
UPROPERTY(EditAnywhere, BlueprintReadWrite)
int32 Age = 20;
</pre></div>
<p>Now we can access the Age property in two ways, directly, or using the SetEditorProperty method:</p>
<div class="cplusplus"><pre>
<span class="comment">// c++</span>
UMyActorComponent* Component = NewObject&lt;UMyActorComponent&gt;();
Component-&gt;Age = 13;
</pre></div>
<p>or </p>
<div class="python"><pre>
<span class="comment"># python </span>
component = unreal<span class="number">.</span>MyActorComponent();
component<span class="number">.</span>age = <span class="number">13</span>;
component<span class="number">.</span>set_editor_property(<span class="string">&quot;Age&quot;</span>,<span class="number">13</span>);
</pre></div>
<p>Using set_editor_property is the preferred way because it interacts with the
property system, sending on-property-changed events and flagging the object has dirty and needing saving. </p>
<h2 id="class-default-objects-cdos">Class Default Objects (CDOs)</h2>
<p>A class default object is an instance of a class which is created and owned by Unreal
and which holds the default values for the classes properties.  The class default object
is generated when the engine starts and is sometimes recreated, for example
if the class is a blueprint, it is recreated whenever the blueprint is recompiled.</p>
<p>The fact that the class default object is generated as part of engine initialization is important.  It means
that, in your object's constructor, you should not access the Engine, which might not be completely initialized, or
the World, which might not exist, or other object which also might not have been 
initialized yet.  These kind of accesses are better left to other post-initialization
stages such as BeginPlay().</p>
<p>For a non-blueprint class the values stored in the properties of  the class default object 
are set by the constructor of that class.  For a blueprint class the values
stored in the properties of the class default object are read from the blueprint .uasset file.</p>
<p>The class default object can be used when creating
a new object - after calling the object constructor 
the values from the class default object can be copied directly into the new object.</p>
<p>The class default object is accessed in various ways.</p>
<p>In c++ you can do this:</p>
<div class="cplusplus"><pre>
UMyActorComponent* CDO = GetMutableDefault&lt;UMyActorComponent&gt;();
</pre></div>
<p>or</p>
<div class="cplusplus"><pre>
UMyActorComponent* CDO = 
     Cast&lt;UMyActorComponent&gt;( UMyActorComponent::StaticClass()-&gt;GetDefaultObject() );
</pre></div>
<p>or</p>
<div class="cplusplus"><pre>
UMyActorComponent* CDO = 
    UMyActorComponent::StaticClass()-&gt;GetDefaultObject&lt;UMyActorComponent&gt;();
</pre></div>
<p>and in python you can do this:</p>
<div class="python"><pre>
component = unreal<span class="number">.</span>MyActorComponent();
cdo = component<span class="number">.</span>get_default_object()
</pre></div>
<p>or</p>
<div class="python"><pre>
cdo = unreal<span class="number">.</span>MyActorComponent<span class="number">.</span>get_default_object()
</pre></div><h2 id="static-classes">Static Classes</h2>
<p>When the Unreal header tool processes UMyActorComponent.h it generates 
 code for a UClass structure specific to  the  UMyActorComponent class.</p>
<p>This instance of UClass contains data used in the 
reflection system including data about each function
and property of the class.  </p>
<p>The static class is accessed in c++ like this:</p>
<div class="cplusplus"><pre>
UClass* MyClass = UMyActorComponent::StaticClass();
</pre></div>
<p>and in python:</p>
<div class="python"><pre>
my_class = unreal<span class="number">.</span>MyActorComponent<span class="number">.</span>static_class()
</pre></div>
<p>The static class can be used to retrieve reflection information,
for example the class name:</p>
<div class="python"><pre>
<span>print</span>(unreal<span class="number">.</span>MyActorComponent().static_class().get_full_name())
</pre></div>
<blockquote>
<p>Class /Script/UObjects.MyActorComponent</p>
</blockquote>
<h2 id="generated-classes">Generated Classes</h2>
<p>This section applies only to blueprints.</p>
<p>If we create a new blueprint derived from the Actor class, and then add a MyActorComponent component 
to it, the &quot;age&quot; property of that component will have the default value of 20 which we set
in the MyActorComponent constructor in c++ and which is now in the MyActorComponent class default object.</p>
<p>If we open the new blueprint in the Unreal editor and change the value of &quot;age&quot; to
25 and save the blueprint, 25 is now that default value of age which will be used
when any instance of the blueprint is created (for example by dropping it on the world map).</p>
<p>In python we can load the blueprint asset like this:</p>
<div class="python"><pre>
bp =  unreal<span class="number">.</span>EditorAssetSubsystem().load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>)
</pre></div>
<p>The variable <code>bp</code> now holds an object of type unreal.Blueprint - note that 
the blueprint has a different type than the object is will create; the blueprint is an unreal.Blueprint, not
an unreal.Actor which is the type of thing which the blueprint can create.</p>
<p>Like the MyActorComponent class, a bluepint has a static class:</p>
<div class="python"><pre>
static = unreal<span class="number">.</span>EditorAssetSubsystem().load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>).static_class()
</pre></div>
<p>and a class default object</p>
<div class="python"><pre>
cdo = unreal<span class="number">.</span>EditorAssetSubsystem()
   .load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>).get_default_object()
</pre></div>
<p>Note that <code>unreal.EditorAssetSubsystem().load_asset</code> returns a reference to the loaded
asset.  If the asset is already in memory it will immediately return its address, not load it again, so there is only one instance of that loaded asset returned, so this works:</p>
<div class="python"><pre>
asset1 = unreal<span class="number">.</span>EditorAssetSubsystem().load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>)
asset2 = unreal<span class="number">.</span>EditorAssetSubsystem().load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>)
<span class="keyword">assert</span>( asset1 <span class="keyword">is</span> asset2 )
</pre></div>
<p>Blueprints also have an associated generated class.  This can be retrieved like so:</p>
<div class="python"><pre>
gen = unreal<span class="number">.</span>EditorAssetSubsystem()
   .load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>).generated_class()
</pre></div>
<p>The generated class is of type BlueprintGeneratedClass. Alternatively the BlueprintGeneratedClass can be loaded directly like this:</p>
<div class="python"><pre>
gen = unreal<span class="number">.</span>EditorAssetSubsystem()
   .load_blueprint_class(<span class="string">&quot;/Game/Blueprints/NewBlueprint.NewBlueprint&quot;</span>)
</pre></div>
<p>  You can do things with the 
BlueprintGeneratedClass such as spawn an actor into the level like this:</p>
<div class="python"><pre>
gen = unreal<span class="number">.</span>EditorAssetSubsystem()
   .load_blueprint_class(<span class="string">&quot;/Game/Blueprints/NewBlueprint.NewBlueprint&quot;</span>)
<span class="keyword">assert</span> <span>isinstance</span>(gen, unreal<span class="number">.</span>BlueprintGeneratedClass )
location = unreal<span class="number">.</span>Vector(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)
rotation = unreal<span class="number">.</span>Rotator()
unreal<span class="number">.</span>EditorLevelLibrary
   .spawn_actor_from_class(actor_class=gen, location=location, rotation=rotation)
</pre></div><h2 id="default-values-of-blueprint-components">Default values of Blueprint Components</h2>
<p>From a blueprint you can find its components and then find their class default objects, to get default values 
and reflection information about each component which makes up the blueprint.</p>
<p>For example we created a new blueprint &quot;/Game/Blueprint/NewBlueprint&quot; which contains
our MyActorComponent component. Now we can load the blueprint and find the MyActorComponent component like so:</p>
<div class="python"><pre>
subsystem = unreal<span class="number">.</span>get_engine_subsystem(unreal<span class="number">.</span>SubobjectDataSubsystem)
blueprint = unreal<span class="number">.</span>EditorAssetSubsystem().load_asset(<span class="string">&quot;/Game/Blueprints/NewBlueprint&quot;</span>)
library = unreal<span class="number">.</span>SubobjectDataBlueprintFunctionLibrary()

<span class="comment"># go from subobject handles -&gt; subobjects -&gt; component objects</span>

components = [ comp <span class="keyword">for</span> comp <span class="keyword">in</span> 
				[ library<span class="number">.</span>get_object(subobject) <span class="keyword">for</span> subobject <span class="keyword">in</span> 
					[ subsystem<span class="number">.</span>k2_find_subobject_data_from_handle(handle) <span class="keyword">for</span> handle <span class="keyword">in</span> 
						subsystem<span class="number">.</span>k2_gather_subobject_data_for_blueprint(context=blueprint) ] 
					]
				<span class="keyword">if</span> comp<span class="number">.</span>get_class().get_name() == <span class="string">&quot;MyActorComponent&quot;</span>
			]

<span class="comment"># we only have one component of type &quot;MyActorComponent&quot;</span>
<span class="keyword">assert</span>( <span>len</span>(components) == <span class="number">1</span> )

component = components[<span class="number">0</span>]
</pre></div>
<p>From this component we  can access two different class default objects: (1) for the original MyActorComponent class 
and (2) for the blueprint component itself.  We can retrieve both of these like so:</p>
<div class="python"><pre>
<span class="comment"># get the default value on the MyActorComponent class</span>
<span>print</span>(component<span class="number">.</span>get_default_object().get_editor_property(<span class="string">&quot;age&quot;</span>))
&gt; <span class="number">20</span>
<span class="comment"># get the default value on the NewBlueprint blueprint</span>
<span>print</span>(component<span class="number">.</span>get_editor_property(<span class="string">&quot;age&quot;</span>))
&gt; <span class="number">25</span>
</pre></div><h2 id="references">References</h2>
<p><a href="https://docs.unrealengine.com/5.1/en-US/objects-in-unreal-engine/">Epic Objects in Unreal Engine</a>  <br />
<a href="https://1danielcoelho.github.io/unreal-engine-basics-base-classes/">Base classes</a>  <br />
<a href="https://www.pythonforbeginners.com/lists/nested-list-comprehensions-in-python">Python nested comprehensions</a></p>

</div>
<footer class="no-sidebar">
<div>
<p class="page-footer">
MIT Licensed | Copyright © 2020-2024 John Farrow
: john.farrow@unrealcode.net
</p>
</div>
</footer>
</main>
</div>
</body>
</html>
