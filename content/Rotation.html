<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating a Blueprint Node in C++ | unrealcode.net</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Creating a blueprint node which rotates an Actor around a pivot point">
    
    <link rel="preload" href="/assets/css/0.styles.95d6faab.css" as="style"><link rel="preload" href="/assets/js/app.7a0b5c3f.js" as="script"><link rel="preload" href="/assets/js/3.5e27fb36.js" as="script"><link rel="preload" href="/assets/js/2.32bfe7ad.js" as="script"><link rel="preload" href="/assets/js/27.deeac6c4.js" as="script"><link rel="preload" href="/assets/js/12.0d1be04c.js" as="script"><link rel="prefetch" href="/assets/js/10.49e97280.js"><link rel="prefetch" href="/assets/js/11.6e4ef963.js"><link rel="prefetch" href="/assets/js/13.cc995969.js"><link rel="prefetch" href="/assets/js/14.3f63a4b1.js"><link rel="prefetch" href="/assets/js/15.76794100.js"><link rel="prefetch" href="/assets/js/16.e1c711f6.js"><link rel="prefetch" href="/assets/js/17.a42e1852.js"><link rel="prefetch" href="/assets/js/18.5b341b27.js"><link rel="prefetch" href="/assets/js/19.881cc852.js"><link rel="prefetch" href="/assets/js/20.f4d02171.js"><link rel="prefetch" href="/assets/js/21.38ecd7b3.js"><link rel="prefetch" href="/assets/js/22.cf33510c.js"><link rel="prefetch" href="/assets/js/23.d395fb1c.js"><link rel="prefetch" href="/assets/js/24.a6cfd400.js"><link rel="prefetch" href="/assets/js/25.5ecb9af3.js"><link rel="prefetch" href="/assets/js/26.917edab3.js"><link rel="prefetch" href="/assets/js/28.bcdb9006.js"><link rel="prefetch" href="/assets/js/29.34b726ea.js"><link rel="prefetch" href="/assets/js/30.d895a9cf.js"><link rel="prefetch" href="/assets/js/31.7dc9532a.js"><link rel="prefetch" href="/assets/js/32.633e2b52.js"><link rel="prefetch" href="/assets/js/4.b728e6f4.js"><link rel="prefetch" href="/assets/js/5.c579aa6b.js"><link rel="prefetch" href="/assets/js/6.9ff941c3.js"><link rel="prefetch" href="/assets/js/7.0e72a1a2.js"><link rel="prefetch" href="/assets/js/8.675e70c4.js"><link rel="prefetch" href="/assets/js/9.876839a1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.95d6faab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">unrealcode.net</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Creating a Blueprint Node in C++</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/content/Rotation.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/Rotation.html#manual-rotation" class="sidebar-link">Manual Rotation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/content/Rotation.html#blueprint-rotation" class="sidebar-link">Blueprint Rotation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/content/Rotation.html#header-file" class="sidebar-link">Header File</a></li><li class="sidebar-sub-header"><a href="/content/Rotation.html#ufunction-declaration" class="sidebar-link">UFUNCTION Declaration</a></li><li class="sidebar-sub-header"><a href="/content/Rotation.html#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/content/Rotation.html#usage" class="sidebar-link">Usage</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1>Creating a Blueprint Node in C++</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This post is about creating a new Blueprint node in c++ to rotate an Actor object around
a pivot point.</p> <p>The image below shows a mesh (called SM_Arm) that was imported into Unreal from
a FBX file generated in Blender.</p> <p><img src="/images/rotn_001.png" alt=""></p> <p>The gizmo on the left is at the position of a socket.  The red, green and blue lines near the middle
indicate the origin of the mesh, which is where the origin was in the Blender model.</p> <p>We create a new blueprint actor, add a Static Mesh component, and
set the mesh to SM_Arm.  If we place this actor in the world,
select it in the outliner, and press E to rotate it, the rotation gizmo (which
indicates the pivot point around which it will rotate) is
positioned on the origin of the SM_Arm mesh:</p> <p><img src="/images/rotn_002.png" alt=""></p> <h2 id="manual-rotation"><a href="#manual-rotation" class="header-anchor">#</a> Manual Rotation</h2> <p>If we want to manually rotate around the socket position, we can use ALT-middle-mouse-click
to temporarily move the pivot point like so:</p> <p><img src="/images/rotn_003.png" alt=""></p> <p>Once we have applied a rotation the pivot point will return to the original position.</p> <h2 id="blueprint-rotation"><a href="#blueprint-rotation" class="header-anchor">#</a> Blueprint Rotation</h2> <h3 id="header-file"><a href="#header-file" class="header-anchor">#</a> Header File</h3> <p>No existing single blueprint node supports rotating an actor around a specified pivot point, so as an
exercise I decided to write one.</p> <p>A blueprint node can be implemented as a static function on a c++ class which is derived from
the UBlueprintFunctionLibrary class.  To create such a node use the <code>Tools | New C++ Class</code> menu option and create a class
derived from UBlueprintFunctionLibrary.  In this example the new class is called &quot;UtilityFunctionLibrary&quot;.</p> <p>Unreal will create the header and implementation files.  The header looks like this:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;CoreMinimal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Kismet/BlueprintFunctionLibrary.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;UtilityFunctionLibrary.generated.h&quot;</span></span>

<span class="token function">UCLASS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MYPROJECT8_API</span> UUtilityFunctionLibrary <span class="token operator">:</span> <span class="token keyword">public</span> UBlueprintFunctionLibrary
<span class="token punctuation">{</span>
	<span class="token function">GENERATED_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>There are no methods on the new class.  We can add one like so:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;CoreMinimal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Kismet/BlueprintFunctionLibrary.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;UtilityFunctionLibrary.generated.h&quot;</span></span>

<span class="token function">UCLASS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MYPROJECT8_API</span> UUtilityFunctionLibrary <span class="token operator">:</span> <span class="token keyword">public</span> UBlueprintFunctionLibrary
<span class="token punctuation">{</span>
	<span class="token function">GENERATED_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintCallable<span class="token punctuation">,</span> Category <span class="token operator">=</span> <span class="token string">&quot;Utility&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RotateActorAroundPivot</span><span class="token punctuation">(</span> 
		AActor<span class="token operator">*</span> Actor<span class="token punctuation">,</span>
		<span class="token keyword">const</span> FVector<span class="token operator">&amp;</span> PivotLocation<span class="token punctuation">,</span>
		<span class="token keyword">const</span> FRotator<span class="token operator">&amp;</span> DeltaRotation <span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The new function RotateActorAroundPivot takes as parameters the actor object we want to rotate, the pivot point
we want to rotate it around, and the size of the rotation.</p> <h3 id="ufunction-declaration"><a href="#ufunction-declaration" class="header-anchor">#</a> UFUNCTION Declaration</h3> <p>There are a couple of improvements we can make to the declaration of the RotateActorAroundPivot function, which currently
looks like this:</p> <p><img src="/images/rotn_004.png" alt=""></p> <ul><li>we can make the Actor parameter default to &quot;self&quot;, which is the actor which this blueprint is a part of, by adding <code>meta = (DefaultToSelf = &quot;Actor&quot;)</code>
to the UFUNCTION declaration</li> <li>we can make the node easier to use by making the parameters optional (so they will be replaced by default values), by making them values, not references.</li></ul> <p>The updated declaration looks this this:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintCallable<span class="token punctuation">,</span> Category <span class="token operator">=</span> <span class="token string">&quot;Utility&quot;</span><span class="token punctuation">,</span> meta <span class="token operator">=</span> <span class="token punctuation">(</span>DefaultToSelf <span class="token operator">=</span> <span class="token string">&quot;Actor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RotateActorAroundPivot</span><span class="token punctuation">(</span>
	AActor<span class="token operator">*</span> Actor<span class="token punctuation">,</span>
	<span class="token keyword">const</span> FVector PivotLocation<span class="token punctuation">,</span>
	<span class="token keyword">const</span> FRotator DeltaRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>and the node now looks like this:</p> <p><img src="/images/rotn_005.png" alt=""></p> <h3 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h3> <p>The implementation of the node contains the maths operations needed to rotate the actor around the pivot point:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">UUtilityFunctionLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">RotateActorAroundPivot</span><span class="token punctuation">(</span>
	AActor<span class="token operator">*</span> Actor<span class="token punctuation">,</span>
	<span class="token keyword">const</span> FVector PivotLocation<span class="token punctuation">,</span>
	<span class="token keyword">const</span> FRotator DeltaRotation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Actor<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	Actor<span class="token operator">-&gt;</span><span class="token function">AddActorWorldRotation</span><span class="token punctuation">(</span>DeltaRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FVector NewActorLocation <span class="token operator">=</span> Actor<span class="token operator">-&gt;</span><span class="token function">GetActorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	NewActorLocation <span class="token operator">-=</span> PivotLocation<span class="token punctuation">;</span>
	NewActorLocation <span class="token operator">=</span> 
	   <span class="token function">FRotationMatrix</span><span class="token punctuation">(</span>DeltaRotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TransformPosition</span><span class="token punctuation">(</span>NewActorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
	NewActorLocation <span class="token operator">+=</span> PivotLocation<span class="token punctuation">;</span>
	NewActorLocation <span class="token operator">-=</span> Actor<span class="token operator">-&gt;</span><span class="token function">GetActorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Actor<span class="token operator">-&gt;</span><span class="token function">AddActorWorldOffset</span><span class="token punctuation">(</span>NewActorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>This code is very substantially based on the code the editor uses to implement manual rotation.</p> <h3 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h3> <p>This blueprint shows an example usage:</p> <img src="/images/rotn_006.png" id="BP2"> <p>Every tick it:</p> <ul><li>multiplies the tick duration by a factor (the Rotation Step variable) to calculate a rotation amount</li> <li>finds the location of the named socket on the Static Mesh component of the actor</li> <li>and rotates the actor around the position of that socket.</li></ul> <p>(This does not need sockets to work, the pivot location could come from anywhere.)</p> <p>If the socket name is left blank, so the socket location is (0,0,0), the mesh rotates around its origin like so:</p> <p><img src="/images/rotn_020.gif" alt=""></p> <p>Whereas if a socket is chosen which is on the narrow end of the arm mesh, the rotation is like this:</p> <p><img src="/images/rotn_021.gif" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main> <footer class="f"><div><p>MIT Licensed | Copyright © 2020-2023 John Farrow</p></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7a0b5c3f.js" defer></script><script src="/assets/js/3.5e27fb36.js" defer></script><script src="/assets/js/2.32bfe7ad.js" defer></script><script src="/assets/js/27.deeac6c4.js" defer></script><script src="/assets/js/12.0d1be04c.js" defer></script>
  </body>
</html>
