(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{344:function(e,t,s){"use strict";s.r(t);var a=s(14),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",[e._v(e._s(this.$page.title))]),e._v(" "),t("h2",{attrs:{id:"about-mass"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#about-mass"}},[e._v("#")]),e._v(" About Mass")]),e._v(" "),t("p",[e._v("Mass is a framework for supporting large amounts of entities in a game by using data oriented\napproaches.  Mass is implemented in Unreal 5.2 as a collection of plugins.")]),e._v(" "),t("p",[e._v("This post is based on "),t("a",{attrs:{href:"https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass",target:"_blank",rel:"noopener noreferrer"}},[e._v("this tutorial"),t("OutboundLink")],1),e._v(" combined with additional information.")]),e._v(" "),t("h2",{attrs:{id:"an-example-project"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#an-example-project"}},[e._v("#")]),e._v(" An Example Project")]),e._v(" "),t("p",[e._v("Launch Unreal 5.2 or higher, create a new project with Games, Third Person, C++, Desktop, Maximum")]),e._v(" "),t("p",[e._v("Enable these plugins:")]),e._v(" "),t("ul",[t("li",[e._v("MassAI")]),e._v(" "),t("li",[e._v("MassCrowd")]),e._v(" "),t("li",[e._v("MassEntity")]),e._v(" "),t("li",[e._v("MassGameplay")]),e._v(" "),t("li",[e._v("StateTree")]),e._v(" "),t("li",[e._v("ZoneGraph")]),e._v(" "),t("li",[e._v("ZoneGraph Annotations")])]),e._v(" "),t("p",[e._v("Restart the editor if requested.")]),e._v(" "),t("h2",{attrs:{id:"c-classes-for-entity-fragment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#c-classes-for-entity-fragment"}},[e._v("#")]),e._v(" C++ Classes for Entity, Fragment")]),e._v(" "),t("h3",{attrs:{id:"fragments"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fragments"}},[e._v("#")]),e._v(" Fragments")]),e._v(" "),t("p",[e._v("The Fragment is the structure which holds data for entities in Mass.  Every fragment must derive"),t("br"),e._v("\nfrom the "),t("code",[e._v("FMassFragment")]),e._v(" struct.  The "),t("code",[e._v("FMassFragment")]),e._v(" struct is declared like this:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("USTRUCT()\nstruct FMassFragment\n{\n\tGENERATED_BODY()\n\tFMassFragment() {}\n};\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("It has no data or members so adds no size to the data stored in the derived\nfragment.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('USTRUCT()\nstruct MASSCOMMON_API FAgentRadiusFragment : public FMassFragment\n{\n\tGENERATED_BODY()\n\tUPROPERTY(EditAnywhere, Category = "")\n\tfloat Radius = 40.f;\n};\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("Deriving from FMassFragment adds no data to the object, the sizeof(float) is 4 and sizeof(FAgentRadiusFragment) is also 4.")]),e._v(" "),t("h3",{attrs:{id:"tags"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tags"}},[e._v("#")]),e._v(" Tags")]),e._v(" "),t("p",[e._v("A tag is structure like a Fragment but it does not hold any data.  It is\nused to filter entities in queries, so you can select entities which do\nor do not have the specified tag.")]),e._v(" "),t("p",[e._v("For example this tag is used to differentiate the crowd entity\nfrom other entities in the MassCrowd module, so the crowd entity will\nhave this tag and no other entity will have it.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("USTRUCT()\nstruct MASSCROWD_API FMassCrowdTag : public FMassTag\n{\n\tGENERATED_BODY()\n};\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("h3",{attrs:{id:"archetypes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#archetypes"}},[e._v("#")]),e._v(" Archetypes")]),e._v(" "),t("p",[e._v("An archtype is a unique combination of fragment and tag types.")]),e._v(" "),t("p",[e._v("The struct "),t("strong",[e._v("FMassArchetypeData")]),e._v(" stores details of the fragment types\nand tag types which make up the archetype.  It also stores\nthe actual fragment data in an array of "),t("strong",[e._v("FMassArchetypeChunk")]),e._v(" chunks.\nA chunk is a small object which holds the fragments (that is the data) for\na fixed small number of entities.")]),e._v(" "),t("p",[e._v("For example if the entity consists of two fragments, a VelocityFragment\nand a PositionFragment, and there are 32 entities, then each chunk\nmight hold the data for (say) 4 entities, so there would be 8 chunks\nand each chunk found logically look like this:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("struct Chunk\n{\n    VelocityFragment Velocities[4];\n    PositionFragment Positions[4];\n};\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("The intent here is that a Processor (i.e. a function which updates entities) will\nexecute a query to fetch an archetype which contains only the data which it\nneeds and then operate on that data and the data will be in a cache-friendly layout because:")]),e._v(" "),t("ul",[t("li",[e._v("only needed data is returned in the archetype so no cycles are wasted copying\nunnecessary data")]),e._v(" "),t("li",[e._v("the chunk size is derived from the cache line size so as far as is possible\nall the data needed by the function is in the cache at once")])]),e._v(" "),t("p",[e._v('Anyone seen this strange behavior with the LOD system? If my number of entities exceeds the LODMax "Low" count, they all get culled with tag MassVisibilityCulledByFrustumTag (or is that by design? I thought it would keep that count visible and cull the rest)\nBoltz â€” Today at 13:25\nTurns out this was because the MassLODCollectorPRocessor is disabled by default (only the Crowd version is enabled), which means that the view distance was not being calculated')]),e._v(" "),t("p",[e._v("Explain each of these with their associated c++ class")]),e._v(" "),t("p",[e._v("Mass Key Terminology")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("Entity - This is the base class of Mass that holds pointers to all of its Fragments\nFragment - Holds the data/state for an Entity in tightly packed arrays (e.g. transform, velocity, current LOD, etc.)\nArchetype - Entities with identical Fragment composition that are grouped together. Entity composition can change at runtime resulting in Archetype migration\nTrait - Group fragments together and typically represent Entity features (e.g. Movement, ZoneGraph Navigation, SmartObject User)\nTags - Archetype-level, Dataless Fragments that can be used by Queries for filtering archetypes based on their presence or absence\nChunk Fragment - Fragments that are applied to a subset of Entities in an Archetype instead of directly to a single Entity\nShared Fragment - Fragments with data that are shared with multiple entities for memory optimization purposes\nProcessor - Where logic execution occurs in Mass. Processors can change values of a Fragment as well as composition of Entities (adding or removing).\nEntity Query - A query used by processors that filters archetypes based on fragment and/or tag requirements. The EntityQuery returns batches of fragments without regard to the individual Entity identifiers\nMass Spawner - System for adding Entities to a level at runtime\nMass Entity Config - Asset that defines the Mass agent to spawn by specifying traits of the Entity\n")])])]),t("h2",{attrs:{id:"entity-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#entity-setup"}},[e._v("#")]),e._v(" Entity Setup")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass",target:"_blank",rel:"noopener noreferrer"}},[e._v("following"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Add a new folder Content/MASS\nAdd a Miscellaneous > Data Asset > Class = MassEntityConfigAsset, Name = MassNPCEntityConfig\nMake a new Level from File > New Level > Basic")]),e._v(" "),t("p",[e._v("So at a high level we have")]),e._v(" "),t("p",[e._v("Level\nMass Spawner object on map\nEntity Types = MassEntityConfigAsset[]\n-- list of types of entities which get spawned\n-- MassEntityConfigAsset\n-- has list of traits i.e movement, visualization, debug, replication - long list\n-- its made up of traits which are collections of fragments?\n-- has debug visualization trait - display cones or whatever\n-- visualzation trait\n-- can specify static meshes/actors for LODS\n-- lod high, medium, low, off"),t("br"),e._v("\n-- count of entities\n-- proportional split between types\nSpawn Data Generators =\n-- list of generators = EnvironmentQuery[]\n-- generator has a query template\n-- i.e. generate items around querier, radius 1000-3000 5 rings etc\n-- generates spawn points?")]),e._v(" "),t("p",[e._v('Adding Visualization trait and pressing "Validate Entity Config" button logs this:')]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("LogMass: Error: Trait(MassVisualizationTrait) has missing dependency:\nLogMass: Error:         MassViewerInfoFragment\nLogMass: Error:         TransformFragment\nLogMass: Error:         MassActorFragment\nLogMass: Error: Some traits are requiring the presence of fragments which are missing!\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v('Fix by adding another trait of type "Assorted Fragments" then add the 3 fragments\nto that trait.')]),e._v(" "),t("p",[e._v("Debugging:\ntype EnableGDT into CMD console to display stuff")]),e._v(" "),t("h2",{attrs:{id:"todo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[e._v("#")]),e._v(" TODO")]),e._v(" "),t("p",[e._v("shared fragments\nshared tags")]),e._v(" "),t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://learn.microsoft.com/en-us/sysinternals/downloads/coreinfo",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoreInfo"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://dev.epicgames.com/community/learning/tutorials/JXMl/unreal-engine-your-first-60-minutes-with-mass",target:"_blank",rel:"noopener noreferrer"}},[e._v("First 60 minutes with Mass"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://docs.unrealengine.com/5.2/en-US/overview-of-mass-entity-in-unreal-engine/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Overview of Mass"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);