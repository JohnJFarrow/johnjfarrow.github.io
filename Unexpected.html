<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" type="text/css" href="./css/styles.css">
<link rel="stylesheet" type="text/css" href="./css/syntaxhighlightingstyles.css">
<link rel="stylesheet" type="text/css" href="./css/print.css" media="print">
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({ startOnLoad: true, theme: 'base', 'themeVariables': {'darkMode': true,'primaryTextColor':'#000','primaryColor': '#fff','primaryBorderColor': '#000','lineColor': 'yellow','secondaryColor': '#006100','tertiaryColor': '#fff' } });
</script>
<title>Unexpected Unreal Behaviour | unrealcode.net</title>
<meta name="description" content="Unexpected Unreal Behaviour">
</head>
<body>
<div id="app" data-server-rendered="true">
<div class="theme-container">
</div>
<header class="navbar">
<div class="sidebar-button">
</div>
<a href="index.html" aria-current="page" class="home-link router-link-exact-active router-link-active">
<span class="site-name">
unrealcode.net
</span>
</a>
<div class="links">
<nav class="nav-links can-hide">
<div class="nav-item">
<a href="index.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
Home
</a>
</div>
</nav>
</div>
</header>
<div class="sidebar-mask">
</div>
<aside class="sidebar">
<ul class="sidebar-links">
<li>
<section class="sidebar-group depth-0">
<p class="sidebar-heading open">
<span>
Unexpected Unreal Behaviour
</span>
</p>
<ul class="sidebar-links sidebar-group-items">
<li>
<a class="sidebar-link" href="#introduction">
Introduction
</a>
</li>
<li>
<a class="sidebar-link" href="#the-unreal-header-tool-sometimes-changes-method-parameter-declarations">
The Unreal Header Tool sometimes changes method parameter declarations
</a>
</li>
<li>
<a class="sidebar-link" href="#the-unreal-header-tool-is-not-fully-satisfied-by-forward-declarations">
The Unreal Header Tool is not fully satisfied by forward declarations
</a>
</li>
</ul>
</section>
</li>
</ul>
</aside>
<main class="page">
<div class="theme-default-content content__default">
<h1>Unexpected Unreal Behaviour</h1>
<h2 id="introduction">Introduction</h2>
<p>This is notes on Unreal Engine behaviour which might surprise.</p>
<ol>
<li> <a href="#internal_params">The Unreal Header Tool sometimes changes method parameter declarations</a></li>
<li> <a href="#internal_forward">The Unreal Header Tool is not fully satisfied by forward declarations</a></li>
</ol>
<p id="internal_params"/>
<h2 id="the-unreal-header-tool-sometimes-changes-method-parameter-declarations">The Unreal Header Tool sometimes changes method parameter declarations</h2>
<p>Given a class declared like this:</p>
<div class="cplusplus"><pre>
USTRUCT(BlueprintType)
<span class="keyword">struct</span> EXAMPLE_API FActionContainer
{
	GENERATED_BODY()

};

UCLASS()
<span class="keyword">class</span> EXAMPLE_API AMyCharacter : <span class="keyword">public</span> ACharacter
{
	GENERATED_BODY()

<span class="keyword">public</span>:
	<span class="comment">// Sets default values for this character&#39;s properties</span>
	AMyCharacter();

	UFUNCTION(BlueprintImplementableEvent, Category = <span class="string">&quot;Interaction&quot;</span>)
	<span class="keyword">void</span> OpenExpandableItemActions(TArray&lt;FActionContainer&gt; actions);
};
</pre></div>
<p>The above code will not compile.  In the output window we get this error:</p>
<pre><code>1&gt;MyCharacter.gen.cpp(71): error C2511: 
	'void AMyCharacter::OpenExpandableItemActions(const TArray&lt;FActionContainer,FDefaultAllocator&gt; &amp;)': 
	overloaded member function not found in 'AMyCharacter'
1&gt;MyCharacter.h(19): 
	note: see declaration of 'AMyCharacter'
1&gt;MyCharacter.gen.cpp(75): 
	error C2352: 'UObject::FindFunctionChecked': a call of a non-static member function requires an object
1&gt;Object.h: 
	see declaration of 'UObject::FindFunctionChecked'
</code></pre>
<p>What is happening here is that the Unreal Header Tool (UHT)
is generating code into the file MyCharacter.gen.cpp, and the code it is
generating has different parameter types than the code 
in our class declaration.  The code in the generated .cpp file looks like this:</p>
<div class="cplusplus"><pre>
<span class="keyword">static</span> FName NAME_AMyCharacter_OpenExpandableItemActions = FName(TEXT(<span class="string">&quot;OpenExpandableItemActions&quot;</span>));
<span class="keyword">void</span> AMyCharacter::OpenExpandableItemActions(<span class="keyword">const</span> TArray&lt;FActionContainer&gt;&amp; actions)
{
	MyCharacter_eventOpenExpandableItemActions_Parms Parms;
	Parms.actions=actions;
	ProcessEvent(FindFunctionChecked(NAME_AMyCharacter_OpenExpandableItemActions),&amp;Parms);
}
</pre></div>
<p>This code is generated to support the <code>BlueprintImplementableEvent</code> aspect of the
<code>OpenExpandableItemActions</code> method, so that the method can be implemented
in a blueprint rather than in c++.</p>
<p>The UHT generates code which uses the types which blueprint supports, which in this
example are different from the types we used when declaring <code>OpenExpandableItemActions</code>.
Specifically UHT changes the type of the <code>actions</code> parameter 
from <code>TArray&lt;FActionContainer&gt;</code> to <code>const TArray&lt;FActionContainer&gt;&amp;</code>, i.e.
it changes a value type to a const reference type.</p>
<p>The solution to this error is to change our header to define the method
the way UHT wants, i.e. using a const reference like this:</p>
<div class="cplusplus"><pre>
UCLASS()
<span class="keyword">class</span> GARBAGECOLLECTION_API AMyCharacter : <span class="keyword">public</span> ACharacter
{
	GENERATED_BODY()

<span class="keyword">public</span>:
	<span class="comment">// Sets default values for this character&#39;s properties</span>
	AMyCharacter();

	UFUNCTION(BlueprintImplementableEvent, Category = <span class="string">&quot;Interaction&quot;</span>)
	<span class="keyword">void</span> OpenExpandableItemActions(<span class="keyword">const</span> TArray&lt;FActionContainer&gt;&amp; actions);
};
</pre></div><p id="internal_forward"/>
<h2 id="the-unreal-header-tool-is-not-fully-satisfied-by-forward-declarations">The Unreal Header Tool is not fully satisfied by forward declarations</h2>
<p ProjectName="">If you generate a first person game project with C++ from the Unreal Editor you create a file
called Character.h.  This contains forward declares the type <code>USkeletalMeshComponent</code>
and then uses it like this:</p>
<div class="cplusplus"><pre>
...
<span class="keyword">class</span> USkeletalMeshComponent;
...
UCLASS(config=Game)
<span class="keyword">class</span> AProjectCharacter : <span class="keyword">public</span> ACharacter
{
	GENERATED_BODY()

	<span class="comment">/** Pawn mesh: 1st person view (arms; seen only by self) */</span>
	UPROPERTY(VisibleDefaultsOnly, Category=Mesh)
	USkeletalMeshComponent* Mesh1P;
	...
}
</pre></div>
<p>This makes it look as though when UHT processes the <code>UPROPERTY</code> macro it uses the forward
declaration to resolve the <code>USkeletalMeshComponent</code> type.  But it does not.  If you
change the <code>USkeletalMeshComponent</code> type to something which does not exist such as <code>NonExistantClass</code> like so:</p>
<div class="cplusplus"><pre>
...
<span class="keyword">class</span> NonExistantClass;
...
UCLASS(config=Game)
<span class="keyword">class</span> AProjectCharacter : <span class="keyword">public</span> ACharacter
{
	GENERATED_BODY()

	<span class="comment">/** Pawn mesh: 1st person view (arms; seen only by self) */</span>
	UPROPERTY(VisibleDefaultsOnly, Category=Mesh)
	NonExistantClass* Mesh1P;
	...
}
</pre></div>
<p>This will not compile, it fails with this error:</p>
<pre><code>1&gt;ProjectCharacter.h(28): error : Unrecognized type 'NonExistantClass' - type must be a UCLASS, USTRUCT, 
                  UENUM, or global delegate.
</code></pre>
<p>Using a forward declaration to a non-existant class would work in straight C++, but 
the UHT must be parsing the engine and project code and maintaining a list of UCLASS, USTRUCT, UENUM types and
failing if it does not find the specified type.</p>

</div>
<footer class="no-sidebar">
<div>
<p class="page-footer">
MIT Licensed | Copyright Â© 2020-2024 John Farrow
: john.farrow@unrealcode.net
</p>
</div>
</footer>
</main>
</div>
</body>
</html>
