
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://johnjfarrow.github.io/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://johnjfarrow.github.io/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://johnjfarrow.github.io/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://johnjfarrow.github.io/theme/pygments/emacs.min.css">



  <link rel="stylesheet" type="text/css" href="https://johnjfarrow.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://johnjfarrow.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://johnjfarrow.github.io/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="https://johnjfarrow.github.io/custom.css">

    <link href="https://johnjfarrow.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Unreal Code Atom">



  


 

<meta name="author" content="John Farrow" />
<meta name="description" content="Creating Blueprints in Python" />
<meta name="keywords" content="unreal engine, python, blueprints">


  <meta property="og:site_name" content="Unreal Code"/>
  <meta property="og:title" content="Using Python to Create Unreal Engine Objects"/>
  <meta property="og:description" content="Creating Blueprints in Python"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://johnjfarrow.github.io/using-python-to-create-unreal-engine-objects.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-07-30 10:27:00+12:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://johnjfarrow.github.io/author/john-farrow.html">
  <meta property="article:section" content="unreal"/>
  <meta property="article:tag" content="unreal engine"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="blueprints"/>
  <meta property="og:image" content="">

  <title>Unreal Code &ndash; Using Python to Create Unreal Engine Objects</title>

</head>
<body >
  <aside>
    <div>
      <a href="https://johnjfarrow.github.io/">
        <img src="https://johnjfarrow.github.io/theme/img/profile.png" alt="" title="">
      </a>

      <h1>
        <a href="https://johnjfarrow.github.io/"></a>
      </h1>

<p>Experimental Unreal Engine Code</p>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/johnjfarrow/" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/johnjfarrow" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://johnjfarrow.github.io/">Home</a>


      <a href="https://johnjfarrow.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="using-python-to-create-unreal-engine-objects">Using Python to Create Unreal Engine&nbsp;Objects</h1>
    <p>
      Posted on July 30, 2022 in <a href="https://johnjfarrow.github.io/category/unreal.html">unreal</a>

    </p>
  </header>


  <div>
    <h2>Introduction</h2>
<p>The Unreal Editor ships with python 3.9.7 embedded in it.  You do not need to install any other distribution of&nbsp;python.</p>
<p>The Unreal Engine 5.0 python documentation is found at <a href="https://docs.unrealengine.com/5.0/en-US/PythonAPI/">https://docs.unrealengine.com/5.0/en-<span class="caps">US</span>/PythonAPI/</a></p>
<h2>Basics</h2>
<p>To use python in Unreal Editor first make sure these plugins are enabled:
- &#8220;Python Editor Script Plugin&#8221;
- &#8220;Editor Scripting&nbsp;Utilities&#8221;</p>
<p>We will be editing python commands in a file external to Unreal and executing it from the command line at the bottom of the Output Log&nbsp;window:</p>
<p><img alt="" src="/images/python_001.png"></p>
<p>To tell Unreal which directory your python files will be loaded from, use the <code>Edit | Project Settings...</code> menu option, then type &#8220;python&#8221; in the filter text box.  You
should see a window like this&nbsp;one:</p>
<p><img alt="" src="/images/python_002.png"></p>
<p>Click the &#8220;+&#8221; next to the Additional Paths and add the location of your files.  You may need to restart the editor after&nbsp;this.</p>
<p>The script we use here is called make_world.py.  To load it, make sure the drop-down list on the left of the command line says &#8220;Python&#8221;, 
and enter this&nbsp;command:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">make_world</span> <span class="k">as</span> <span class="nn">MW</span>
</code></pre></div>

<p>In order to change the file externally and reload it, we need to run this command&nbsp;once:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>
</code></pre></div>

<p>and then each time we change the file we can&nbsp;type</p>
<div class="highlight"><pre><span></span><code><span class="n">reload</span><span class="p">(</span><span class="n">MW</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>to reload&nbsp;it.</p>
<p>At the top of the example python file are these&nbsp;lines:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">unreal</span>

<span class="k">def</span> <span class="nf">check_loaded</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;make_world loaded ok&quot;</span><span class="p">)</span>
</code></pre></div>

<p>so to check everything is working we can&nbsp;type</p>
<div class="highlight"><pre><span></span><code><span class="n">reload</span><span class="p">(</span><span class="n">MW</span><span class="p">)</span><span class="w"></span>
<span class="n">MW</span><span class="o">.</span><span class="n">check_loaded</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

<p>and we should see this in the Output&nbsp;Log:</p>
<p><img alt="" src="/images/python_003.png"></p>
<p>To test small pieces of code you can type multiple lines into the command line by separating them with <span class="caps">CTRL</span>-enter, for example you can&nbsp;type</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">unreal</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">LayersSubsystem</span><span class="p">()</span><span class="o">.</span><span class="n">get_world</span><span class="p">())</span>
</code></pre></div>

<p>as one command.  To repeatedly reload the python file from disk and execute it you can enter
this as one command (with <span class="caps">CTRL</span>-enter between the&nbsp;lines):</p>
<div class="highlight"><pre><span></span><code><span class="n">reload</span><span class="p">(</span><span class="n">MW</span><span class="p">)</span>
<span class="n">MW</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>The example python file contains multiple functions, so you can call the 
ones you want using a multi-line scripts like&nbsp;so:</p>
<p><img alt="" src="/images/python_004.png"></p>
<h2>Creating a New&nbsp;Level</h2>
<p>This is the code to create a new&nbsp;level:</p>
<div class="highlight"><pre><span></span><code><span class="nv">def</span> <span class="nv">new_level</span><span class="ss">()</span>:
    <span class="nv">ELL</span> <span class="o">=</span> <span class="nv">unreal</span>.<span class="nv">EditorLevelLibrary</span><span class="ss">()</span>
    <span class="nv">created</span> <span class="o">=</span> <span class="nv">ELL</span>.<span class="nv">new_level</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">/Game/Levels/NewLevel</span><span class="s2">&quot;</span><span class="ss">)</span>
    <span class="k">return</span> <span class="nv">created</span>
</code></pre></div>

<p>This will generate output similar to this in the Output Log&nbsp;window:</p>
<blockquote>
<p>Cmd: <span class="caps">OBJ</span> <span class="caps">SAVEPACKAGE</span> <span class="caps">PACKAGE</span>=&#8221;/Game/Levels/NewLevel&#8221; <span class="caps">FILE</span>=&#8221;../../../../../../tmp/Content/Levels/NewLevel.umap&#8221; <span class="caps">SILENT</span>=true <span class="caps">AUTOSAVING</span>=false <span class="caps">KEEPDIRTY</span>=false 
LogUObjectHash: Compacting FUObjectHashTables data took   0.32ms<br>
LogSavePackage: Moving output files for package: /Game/Levels/NewLevel<br>
LogSavePackage: Moving &#8216;../../../../../../tmp/MyProject9/Saved/NewLevelF447BBBC4C547A0F0EA7F39017B7A537.tmp&#8217; to &#8216;../../../../../../tmp/MyProject9/Content/Levels/NewLevel.umap&#8217;<br>
LogFileHelpers: Saving map &#8216;NewLevel&#8217; took 0.072<br>
AssetCheck: New page: Asset Save: NewLevel<br>
LogContentValidation: Display: Validating World&nbsp;/Game/Levels/NewLevel.NewLevel  </p>
</blockquote>
<p>If the level already exists it will generate an error like&nbsp;this:</p>
<blockquote>
<p>LevelEditorSubsystem: Error: NewLevel. Failed to validate the destination. An asset already exists at this&nbsp;location.  </p>
</blockquote>
<h2>Making Meshes from <span class="caps">FBX</span>&nbsp;files</h2>
<p>This is the code used to import a set of .fbx files into Static Mesh&nbsp;objects:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">buildStaticMeshImportOptions</span><span class="p">():</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">FbxImportUI</span><span class="p">()</span>
    <span class="n">options</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;import_mesh&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;import_textures&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;import_materials&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;import_as_skeletal&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">static_mesh_import_data</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;import_uniform_scale&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">static_mesh_import_data</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;combine_meshes&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">static_mesh_import_data</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;generate_lightmap_u_vs&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">static_mesh_import_data</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;auto_generate_collision&#39;</span><span class="p">,</span> <span class="kc">True</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">options</span>


<span class="k">def</span> <span class="nf">buildImportTask</span><span class="p">(</span><span class="n">mesh_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">AssetImportTask</span><span class="p">()</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;automated&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;destination_name&#39;</span><span class="p">,</span> <span class="n">mesh_name</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;destination_path&#39;</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;replace_existing&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;replace_existing_settings&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task</span>


<span class="k">def</span> <span class="nf">import_static_meshes</span><span class="p">():</span>
    <span class="n">mesh_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;SM_Arm&quot;</span><span class="p">:</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">work</span><span class="se">\\</span><span class="s2">TrebBlender</span><span class="se">\\</span><span class="s2">Arm.0040_6.fbx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SM_Ramp&quot;</span><span class="p">:</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">work</span><span class="se">\\</span><span class="s2">TrebBlender</span><span class="se">\\</span><span class="s2">Ramp.fbx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SM_Weight&quot;</span><span class="p">:</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">work</span><span class="se">\\</span><span class="s2">TrebBlender</span><span class="se">\\</span><span class="s2">Weight.004_2.fbx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SM_Base&quot;</span><span class="p">:</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">work</span><span class="se">\\</span><span class="s2">TrebBlender</span><span class="se">\\</span><span class="s2">Base.004_3.fbx&quot;</span>
    <span class="p">}</span>

    <span class="n">options</span> <span class="o">=</span> <span class="n">buildStaticMeshImportOptions</span><span class="p">()</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mesh_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">buildImportTask</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mesh_name</span><span class="p">,</span> <span class="s2">&quot;/Game/Meshes&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="n">unreal</span><span class="o">.</span><span class="n">AssetToolsHelpers</span><span class="o">.</span><span class="n">get_asset_tools</span><span class="p">()</span><span class="o">.</span><span class="n">import_asset_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</code></pre></div>

<p>Basically what is does is create a <code>unreal.AssetImportTask()</code> for each fbx file
and then execute it to create a StaticMesh in the &#8220;/Game/Meshes&#8221;&nbsp;directory.</p>
<p>We treat the SM_Base mesh differently.  We want to set the &#8220;Collision Complexity&#8221;
property to &#8220;Use Complex Collision as Simple&#8221;. This involves getting the &#8220;body_setup&#8221;
property from the mesh and updating it.  It is not necessary to set the &#8220;body_setup&#8221;
property back on the mesh - we have reference to it not a&nbsp;copy.</p>
<div class="highlight"><pre><span></span><code><span class="n">EAL</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">EditorAssetLibrary</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">EAL</span><span class="o">.</span><span class="n">load_asset</span><span class="p">(</span><span class="s2">&quot;/Game/Meshes/SM_Base&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMesh</span><span class="p">)</span>
<span class="n">body_setup</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_editor_property</span><span class="p">(</span><span class="s2">&quot;body_setup&quot;</span><span class="p">)</span>
<span class="n">body_setup</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;collision_trace_flag&quot;</span><span class="p">,</span>
    <span class="n">unreal</span><span class="o">.</span><span class="n">CollisionTraceFlag</span><span class="o">.</span><span class="n">CTF_USE_COMPLEX_AS_SIMPLE</span> <span class="p">)</span>
</code></pre></div>

<h2>Making a&nbsp;Blueprint</h2>
<p>This section shows how to make a blueprint which consists of several
components and to set the properties on these&nbsp;components.</p>
<h3>Making the&nbsp;Blueprint</h3>
<p>The code for making a blueprint is&nbsp;so:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make_blueprint</span><span class="p">(</span><span class="n">package_path</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">):</span>
    <span class="n">EAL</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">EditorAssetLibrary</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">BlueprintFactory</span><span class="p">()</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;parent_class&quot;</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">Actor</span><span class="p">)</span>
    <span class="n">asset_tools</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">AssetToolsHelpers</span><span class="o">.</span><span class="n">get_asset_tools</span><span class="p">()</span>
    <span class="n">blueprint</span> <span class="o">=</span> <span class="n">asset_tools</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span><span class="n">asset_name</span><span class="p">,</span> <span class="n">package_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>
</code></pre></div>

<p>This is called by passing in the location where the blueprint will be created
and its name, like&nbsp;so:</p>
<div class="highlight"><pre><span></span><code><span class="n">package_path</span> <span class="o">=</span> <span class="s2">&quot;/Game/Blueprints&quot;</span>
<span class="n">asset_name</span> <span class="o">=</span> <span class="s2">&quot;BP_Trebuchet20&quot;</span>
<span class="n">make_blueprint</span><span class="p">(</span> <span class="n">package_path</span><span class="p">,</span> <span class="n">asset_name</span> <span class="p">)</span>
</code></pre></div>

<h3>Making&nbsp;Components</h3>
<p>Support for making components from python is in Unreal version 5.0.3 but it does not work properly.
It should be working in 5.1. Prior to the release of 5.1 it works in commit a2ee75a206ec3aa9b03bdaa534af842c7439fda3 
of the ue5-main&nbsp;branch.</p>
<p>In the Unreal forums there is a snippet showing <a href="https://dev.epicgames.com/community/snippets/dV5/add-a-component-with-blueprint-script-in-the-editor">how to add components to 
a blueprint using blueprint script</a>.  The code below
follows a similar approach except it uses python instead of&nbsp;blueprints.</p>
<p>First we get the subsytem which is used to create components (aka&nbsp;subobjects):</p>
<div class="highlight"><pre><span></span><code><span class="n">subsystem</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">get_engine_subsystem</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">SubobjectDataSubsystem</span><span class="p">)</span>
</code></pre></div>

<p>Then we get the root object to which components will be&nbsp;added:</p>
<div class="highlight"><pre><span></span><code><span class="n">root_data_handle</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">.</span><span class="n">k2_gather_subobject_data_for_blueprint</span><span class="p">(</span><span class="n">blueprint</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<h4>Handles</h4>
<p>The Unreal python <span class="caps">API</span> distinguishes between an object and a&nbsp;handle.   </p>
<p>Conceptually, a python variable 
(for example of type <code>unreal.Object</code>) holds an&nbsp;object.</p>
<p>A handle (of type <code>unreal.SubobjectDataHandle</code>) holds a reference to
an object, not the object itself. We need to bear in mind that we can
have a handle to an object which no longer exists, for example it was deleted 
after we obtained the&nbsp;handle.</p>
<p>We have put the code for creating a component in a separate&nbsp;function:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="n">new_class</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

    <span class="n">root_data_handle</span> <span class="o">=</span> <span class="n">subsystem</span>
        <span class="o">.</span><span class="n">k2_gather_subobject_data_for_blueprint</span><span class="p">(</span><span class="n">blueprint</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">sub_handle</span><span class="p">,</span> <span class="n">fail_reason</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">.</span><span class="n">add_new_subobject</span><span class="p">(</span>
        <span class="n">unreal</span><span class="o">.</span><span class="n">AddNewSubobjectParams</span><span class="p">(</span>
            <span class="n">parent_handle</span><span class="o">=</span><span class="n">root_data_handle</span><span class="p">,</span>
            <span class="n">new_class</span><span class="o">=</span><span class="n">new_class</span><span class="p">,</span>
            <span class="n">blueprint_context</span><span class="o">=</span><span class="n">blueprint</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fail_reason</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fail_reason&quot;</span><span class="p">,</span> <span class="n">fail_reason</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR from sub_object_subsystem.add_new_subobject: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fail_reason</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">subsystem</span><span class="o">.</span><span class="n">rename_subobject</span><span class="p">(</span><span class="n">sub_handle</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">subsystem</span><span class="o">.</span><span class="n">attach_subobject</span><span class="p">(</span><span class="n">root_data_handle</span><span class="p">,</span> <span class="n">sub_handle</span><span class="p">)</span>

    <span class="n">BFL</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">SubobjectDataBlueprintFunctionLibrary</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">BFL</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">BFL</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">sub_handle</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sub_handle</span><span class="p">,</span> <span class="n">obj</span>
</code></pre></div>

<p>We pass this function:
- the subsytem which is used to create components
- the blueprint we want the component added to
- the class of the component we want created, such as unreal.StaticMeshComponent
- the name of the new&nbsp;component</p>
<p>The function returns both the handle to the object an the object&nbsp;itself.</p>
<p>The function calls <code>subsystem.add_new_subobject()</code> to create the component,
and then we use these lines to get the object from the&nbsp;handle:</p>
<div class="highlight"><pre><span></span><code><span class="n">BFL</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">SubobjectDataBlueprintFunctionLibrary</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">BFL</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">BFL</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">sub_handle</span><span class="p">))</span>
</code></pre></div>

<p>We return the handle and the object because we need the handle
to position the new component as a child of other components, and 
we need to object to set properties on&nbsp;it.</p>
<h4>Creating&nbsp;Components</h4>
<p>The code for creating different types of subcomponents and setting their properties is&nbsp;below.</p>
<p>For a Static Mesh Component we do&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="n">sub_handle</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> 
    <span class="n">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMeshComponent</span><span class="p">,</span> <span class="s2">&quot;Weight&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMeshComponent</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMesh</span><span class="p">)</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">EAL</span><span class="o">.</span><span class="n">load_asset</span><span class="p">(</span><span class="s2">&quot;/Game/Meshes/SM_Weight&quot;</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_static_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;mobility&quot;</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">ComponentMobility</span><span class="o">.</span><span class="n">MOVABLE</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;relative_location&quot;</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">165.0</span><span class="p">,</span> <span class="mf">640.0</span><span class="p">))</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_simulate_physics</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_enable_gravity</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_mass_override_in_kg</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;NAME_None&quot;</span><span class="p">),</span> <span class="mi">4506</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="n">set_collision_profile_name</span><span class="p">(</span><span class="s2">&quot;PhysicsActor&quot;</span><span class="p">)</span>
<span class="n">subsystem</span><span class="o">.</span><span class="n">attach_subobject</span><span class="p">(</span> <span class="n">base_handle</span><span class="p">,</span> <span class="n">sub_handle</span> <span class="p">)</span>
</code></pre></div>

<p>For a Physics Constaint Component we do&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="n">sub_handle</span><span class="p">,</span> <span class="n">arm_base</span> <span class="o">=</span> <span class="n">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> 
     <span class="n">unreal</span><span class="o">.</span><span class="n">PhysicsConstraintComponent</span><span class="p">,</span> <span class="s2">&quot;ArmBaseConstraint&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arm_base</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">PhysicsConstraintComponent</span><span class="p">)</span>

<span class="n">arm_base</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;relative_location&quot;</span><span class="p">,</span> 
    <span class="n">unreal</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mf">10.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">740.000000</span><span class="p">))</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;component_name1&quot;</span><span class="p">,</span> <span class="n">ccBase</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;component_name2&quot;</span><span class="p">,</span> <span class="n">ccArm</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_linear_x_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">LinearConstraintMotion</span><span class="o">.</span><span class="n">LCM_LOCKED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_linear_y_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">LinearConstraintMotion</span><span class="o">.</span><span class="n">LCM_LOCKED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_linear_z_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">LinearConstraintMotion</span><span class="o">.</span><span class="n">LCM_LOCKED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_angular_swing1_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">AngularConstraintMotion</span><span class="o">.</span><span class="n">ACM_LOCKED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_angular_swing2_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">AngularConstraintMotion</span><span class="o">.</span><span class="n">ACM_LOCKED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_angular_twist_limit</span><span class="p">(</span><span class="n">unreal</span><span class="o">.</span><span class="n">AngularConstraintMotion</span><span class="o">.</span><span class="n">ACM_FREE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">arm_base</span><span class="o">.</span><span class="n">set_disable_collision</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">subsystem</span><span class="o">.</span><span class="n">attach_subobject</span><span class="p">(</span> <span class="n">base_handle</span><span class="p">,</span> <span class="n">sub_handle</span> <span class="p">)</span>
</code></pre></div>

<h4>Note on Component&nbsp;Names</h4>
<p>Physics Constraint Components need to know the names of the components
they are connected&nbsp;to.</p>
<p>In c++ this is done by calling SetConstrainedComponents() and passing in 
the two components like&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="n">Base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStaticMeshComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Base&quot;</span><span class="p">));</span><span class="w"></span>
<span class="n">Arm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStaticMeshComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Arm&quot;</span><span class="p">));</span><span class="w"></span>
<span class="n">ArmBaseConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">   </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="w"> </span><span class="n">UPhysicsConstraintComponent</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ArmBaseConstraint&quot;</span><span class="p">));</span><span class="w"></span>
<span class="n">ArmBaseConstraint</span><span class="o">-&gt;</span><span class="n">SetConstrainedComponents</span><span class="p">(</span><span class="w"> </span><span class="n">Base</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Arm</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>From the  <a href="https://docs.unrealengine.com/5.0/en-US/PythonAPI/class/PhysicsConstraintComponent.html">python documentation</a>
it looks as though the same approach would work,&nbsp;namely:</p>
<div class="highlight"><pre><span></span><code><span class="n">base_handle</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> 
   <span class="n">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMeshComponent</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">)</span>
<span class="n">sub_handle</span><span class="p">,</span> <span class="n">arm</span> <span class="o">=</span> 
   <span class="n">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="n">unreal</span><span class="o">.</span><span class="n">StaticMeshComponent</span><span class="p">,</span> <span class="s2">&quot;Arm&quot;</span><span class="p">)</span>
<span class="n">sub_handle</span><span class="p">,</span> <span class="n">constraint</span> <span class="o">=</span> <span class="n">add_subobject</span><span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> 
    <span class="n">unreal</span><span class="o">.</span><span class="n">PhysicsConstraintComponent</span><span class="p">,</span> <span class="s2">&quot;ArmBaseConstraint&quot;</span><span class="p">)</span>
<span class="n">constraint</span><span class="o">.</span><span class="n">set_constrained_components</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">arm</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
</code></pre></div>

<p>But this does not work.  If we use the c++ code, the constraint ends up 
referencing a component named &#8220;Base&#8221;, which is what we want, but using the python
code it ends up a component name of &#8220;Base_GEN_VARIABLE&#8221; for some&nbsp;reason.</p>
<p>So we have to use the <code>set_editor_property()</code> call to specify each constrained component name
and that takes an object of type <code>unreal.ConstrainComponentPropName</code>, so we have to 
make those objects like&nbsp;so:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make_component_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">unreal</span><span class="o">.</span><span class="n">ConstrainComponentPropName</span><span class="p">()</span>
    <span class="n">cc</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;component_name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cc</span>

<span class="n">ccBase</span> <span class="o">=</span> <span class="n">make_component_name</span><span class="p">(</span><span class="s2">&quot;Base&quot;</span><span class="p">)</span>
<span class="n">ccArm</span> <span class="o">=</span> <span class="n">make_component_name</span><span class="p">(</span><span class="s2">&quot;Arm&quot;</span><span class="p">)</span>

<span class="n">constraint</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;component_name1&quot;</span><span class="p">,</span> <span class="n">ccBase</span><span class="p">)</span>
<span class="n">constraint</span><span class="o">.</span><span class="n">set_editor_property</span><span class="p">(</span><span class="s2">&quot;component_name2&quot;</span><span class="p">,</span> <span class="n">ccArm</span><span class="p">)</span>
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://johnjfarrow.github.io/tag/unreal-engine.html">unreal engine</a>
      <a href="https://johnjfarrow.github.io/tag/python.html">python</a>
      <a href="https://johnjfarrow.github.io/tag/blueprints.html">blueprints</a>
    </p>
  </div>






</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses//4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://johnjfarrow.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses//4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l//4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Unreal Code ",
  "url" : "https://johnjfarrow.github.io",
  "image": "",
  "description": ""
}
</script>

  
</body>
</html>